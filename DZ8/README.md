
# Liver Segmentation Using Monai and PyTorch
В этом репозитории вы найдете все файлы Python, необходимые для сегментации печени с помощью Monai и PyTorch, и вы можете использовать тот же код и для сегментации других органов.

Итак, в этом проекте, вы найдете некоторые сценарии, которые я написал сам, а также другие, которые я взял из руководств Монаи. По этому вам нужно заглянуть в их исходный репозиторий и на [веб-сайт](https://monai.io/), чтобы получить дополнительную информацию.

## Packages that need to be installed:
```
pip install monai
```
```
pip install -r requirements.txt
```
## Showing a patient from the dataset
Некоторые из наиболее частых вопросов, которые у меня возникали при использовании медицинской визуализации, касались того, как представить пациента. Чтобы решить эту проблему, я создал явные сценарии, показывающие
пациента из наборов данных обучения и тестирования, которые вы можете увидеть здесь.
```Python
def show_patient(data, SLICE_NUMBER=1, train=True, test=False):
    """
    Эта функция предназначена для отображения одного пациента из ваших наборов данных, чтобы вы могли определить, 
    все ли в порядке или вам нужно что-то изменить/удалить.

    `data`: этот параметр должен брать пациентов из загрузчика данных, а это означает, 
    что вам необходимо сначала подготовить функцию и применить нужные преобразования, после чего передать их в эту функцию, 
    чтобы вы визуализировали пациента с нужными преобразованиями.
    `SLICE_NUMBER`: этот параметр будет принимать номер фрагмента, который вы хотите отобразить/показать
    `train`: этот параметр означает, что вы хотите отобразить пациента из данных обучения (по дефолту - true)
    `test`: этот параметр означает, что вы хотите отобразить пациента из числа тестируемых пациентов.
    """

    check_patient_train, check_patient_test = data

    view_train_patient = first(check_patient_train)
    view_test_patient = first(check_patient_test)

    
    if train:
        plt.figure("Visualization Train", (12, 6))
        plt.subplot(1, 2, 1)
        plt.title(f"vol {SLICE_NUMBER}")
        plt.imshow(view_train_patient["vol"][0, 0, :, :, SLICE_NUMBER], cmap="gray")

        plt.subplot(1, 2, 2)
        plt.title(f"seg {SLICE_NUMBER}")
        plt.imshow(view_train_patient["seg"][0, 0, :, :, SLICE_NUMBER])
        plt.show()
    
    if test:
        plt.figure("Visualization Test", (12, 6))
        plt.subplot(1, 2, 1)
        plt.title(f"vol {SLICE_NUMBER}")
        plt.imshow(view_test_patient["vol"][0, 0, :, :, SLICE_NUMBER], cmap="gray")

        plt.subplot(1, 2, 2)
        plt.title(f"seg {SLICE_NUMBER}")
        plt.imshow(view_test_patient["seg"][0, 0, :, :, SLICE_NUMBER])
        plt.show()

```

Но перед вызовом этой функции вам необходимо выполнить предварительную обработку ваших данных. Фактически эта функция поможет вам визуализировать ваших пациентов после применения различных преобразований, чтобы вы знали, нужно ли вам изменять некоторые параметры или нет.
Функцию, выполняющую предварительную обработку, можно найти в файле preprocess.py, и в этом файле вы найдете функцию prepare(), которую можно использовать для предварительной обработки.

## Training
Поняв, как выполнять предварительную обработку, вы можете начать импортировать `3D Unet` из monai и определить параметры модели (размеры, входные каналы, выходные каналы...).
```Python
model = UNet(
    dimensions=3,
    in_channels=1,
    out_channels=2,
    channels=(16, 32, 64, 128, 256), 
    strides=(2, 2, 2, 2),
    num_res_units=2,
    norm=Norm.BATCH,
).to(device)
```

А для запуска кода вы можете использовать скрипты train.py, которые будут вызывать функцию обучения которую я создал, используя тот же принцип, что и в руководствах Monai.

## Testing the model
Для тестирования модели существует файл «testing.ipynb» блокнота Jupyter, содержащий различные необходимые вам коды. Вы найдете часть для построения графиков обучения/тестирования потерь и коэффициента dice, и, конечно же, вы найдете часть, показывающую результаты одного из тестовых данных, чтобы увидеть выходные данные вашей модели.


